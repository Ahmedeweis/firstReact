# Order Shipping Implementation

## Overview

This implementation adds the ability to ship orders via the API endpoint `POST /orders/{id}/ship` with tracking number functionality.

## API Details

**Endpoint:** `POST {{base_url}}/orders/{id}/ship`

**Headers:**

- `Accept-Language: {{lang}}`
- `Content-Type: application/json`
- `Authorization: Bearer {{auth_token}}`

**Request Body:**

```json
{
  "shipping_method": "DHL"
}
```

**Response Example:**
The API returns the updated order with shipment details including tracking number (auto-generated), shipping method, and updated status.

## Features Implemented

### 1. Backend Integration (`src/utils/axios.ts`)

- Added new endpoint: `order.ship(id)` for shipping orders

### 2. Type Definitions (`src/types/order.ts`)

- Added `IOrderShipment` type for shipment data structure

### 3. Order Details View (`src/sections/order/view/order-details-view.tsx`)

- Added "Ship Order" button in the toolbar (only visible for pending orders)
- Integrated ship order dialog
- Handles shipping API call with proper headers
- Updates order data after successful shipping
- Shows success/error toast notifications

### 4. Order List View (`src/sections/order/view/order-list-view.tsx`)

- Added "Ship Order" action in the row menu (only for pending orders)
- Integrated ship order dialog
- Updates order status in the table after shipping
- Maintains consistent state management

### 5. Order Details Toolbar (`src/sections/order/order-details-toolbar.tsx`)

- Added `onShipOrder` callback prop
- Added `isShipping` loading state prop
- Displays "Ship Order" button with loading state
- Button only visible for pending orders

### 6. Order Table Row (`src/sections/order/order-table-row.tsx`)

- Added `onShipRow` callback prop
- Added "Ship Order" menu item (only visible for pending orders)
- Placed before "View" and "Delete" actions

### 7. Ship Order Dialog (`src/sections/order/order-ship-dialog.tsx`)

- New reusable dialog component
- Displays order information (customer, current shipping method, address)
- Input field for shipping method with validation
- Loading state during API call
- Prevents closing during shipping
- Error handling with user feedback

### 8. Localization

Added translations in both English and Arabic:

**English (`src/locales/langs/en/common.json`):**

- `order.shipOrder`: "Ship Order"
- `order.shipping`: "Shipping..."
- `order.shippingMethod`: "Shipping Method"
- `order.enterShippingMethod`: "Enter shipping method (e.g., DHL, FedEx, UPS)"
- `order.shippingMethodRequired`: "Shipping method is required"
- `order.orderShippedSuccessfully`: "Order shipped successfully!"
- `order.failedToShipOrder`: "Failed to ship order"
- `order.customer`: "Customer"
- `order.address`: "Address"

**Arabic (`src/locales/langs/ar/common.json`):**

- Corresponding Arabic translations for all the above keys

## User Flow

### From Order Details Page:

1. User navigates to order details page
2. If order status is "pending", a "Ship Order" button appears in the toolbar
3. User clicks "Ship Order"
4. Dialog opens showing order information
5. User enters shipping method (e.g., DHL, FedEx, UPS)
6. User clicks "Ship Order" button in dialog
7. API call is made with proper headers and `shipping_method` in request body
8. On success:
   - Success toast is shown
   - Order data is updated with new shipment info (tracking number auto-generated by API)
   - Dialog closes automatically
   - Order status changes to "completed"
9. On error:
   - Error toast is shown
   - User can retry or close dialog

### From Order List Page:

1. User views the order list
2. For pending orders, user can click the three-dot menu
3. "Ship Order" option appears in the menu
4. Same dialog and flow as above
5. Table row updates automatically after shipping

## Technical Details

### API Request Headers

The implementation properly includes all required headers:

- Language preference from localStorage
- Content-Type for JSON
- Authorization Bearer token from sessionStorage

### State Management

- Component-level state for dialog visibility
- Loading states during API calls
- Proper error handling and user feedback
- Optimistic updates after successful shipping

### Form Validation

- Shipping method is required
- Real-time validation feedback
- Prevents submission with empty shipping method

### UI/UX Considerations

- Disabled states during API calls
- Loading indicators
- Prevents accidental dialog closure during shipping
- Clear error messages
- Success feedback
- Conditional rendering based on order status

## Testing Recommendations

1. Test with pending orders
2. Test with non-pending orders (button should not appear)
3. Test shipping method validation
4. Test API error scenarios
5. Test with different languages (English/Arabic)
6. Test concurrent shipping attempts
7. Verify proper header inclusion
8. Verify order status updates correctly
9. Test with various shipping methods (DHL, FedEx, UPS, etc.)

## Future Enhancements

- Add dropdown selector for common shipping methods
- Support bulk order shipping
- Add shipping history/timeline
- Email notifications on shipping
- Integration with shipping providers
- Print shipping labels
- Auto-populate shipping method from order if available
